<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add a Time-to-Event Outcome to a match_time object — add_outcome • MatchTime</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add a Time-to-Event Outcome to a match_time object — add_outcome"><meta name="description" content="After performing time-dependent matching using the match_time function, users usually want to add one or more outcomes to the data. This function may be used to do this efficiently, potentially using different censoring schemes. This is equivalent to including the outcome in the start-stop dataset supplied in the matching process and specifying it in the outcomes argument."><meta property="og:description" content="After performing time-dependent matching using the match_time function, users usually want to add one or more outcomes to the data. This function may be used to do this efficiently, potentially using different censoring schemes. This is equivalent to including the outcome in the start-stop dataset supplied in the matching process and specifying it in the outcomes argument."><meta property="og:image" content="https://robindenz1.github.io/MatchTime/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchTime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MatchTime.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_start_stop_data.html">Creating and Dealing with Start-Stop Data in R</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/MatchTime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Add a Time-to-Event Outcome to a <code>match_time</code> object</h1>

      <div class="d-none name"><code>add_outcome.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>After performing time-dependent matching using the <code><a href="match_time.html">match_time</a></code> function, users usually want to add one or more outcomes to the data. This function may be used to do this efficiently, potentially using different censoring schemes. This is equivalent to including the outcome in the start-stop dataset supplied in the matching process and specifying it in the <code>outcomes</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_outcome</span><span class="op">(</span><span class="va">x</span>, <span class="va">data</span>, censor_at_treat<span class="op">=</span><span class="cn">TRUE</span>,</span>
<span>            censor_pairs<span class="op">=</span><span class="cn">FALSE</span>, units<span class="op">=</span><span class="st">"auto"</span>,</span>
<span>            id<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">id</span>, time<span class="op">=</span><span class="va">x</span><span class="op">$</span><span class="va">time</span>,</span>
<span>            event_time_name<span class="op">=</span><span class="st">".event_time"</span>,</span>
<span>            status_name<span class="op">=</span><span class="st">".status"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>A <code>match_time</code> object created using the <code><a href="match_time.html">match_time</a></code> function.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.table</code> like object including exactly two columns: <code>id</code> (the unique case identifier), <code>time</code> (the time at which an event occurred). May also be any object that can be coerced to be a <code>data.table</code>, such as a <code>data.frame</code> or a <code>tibble</code>. The event times supplied using this argument will then be put into relation with the time at which each case was included during the matching process, giving the time until the event. Cases with no events can simply be omitted from <code>data</code>. If multiple events per person exist, they should be included in the long-format (multiple rows per <code>id</code>). Only the time until the first event after inclusion into the matching data will be used, all previous events and all events afterwards are not used.</p></dd>

  <dt id="arg-censor-at-treat">censor_at_treat<a class="anchor" aria-label="anchor" href="#arg-censor-at-treat"></a></dt>
<dd><p>Either <code>TRUE</code> or <code>FALSE</code>, indicating whether the created event time should be censored at the time of the next treatment. This only applies to cases that were included in the matching process as controls but later become cases themselves. Defaults to <code>TRUE</code>.</p></dd>

  <dt id="arg-censor-pairs">censor_pairs<a class="anchor" aria-label="anchor" href="#arg-censor-pairs"></a></dt>
<dd><p>Either <code>TRUE</code> or <code>FALSE</code>. Only used if <code>censor_at_treat=TRUE</code>. If set to <code>TRUE</code>, the case matched to a control is censored at the same time that the control was censored due to the next treatment occurring. If <code>ratio &gt; 1</code>, the minimum time to "artificial censoring" is used as censoring time for all cases with the same <code>.id_pair</code>. This may in some cases be sufficient to deal with the covariate dependent censoring induced by using <code>censor_at_treat=TRUE</code>.</p></dd>

  <dt id="arg-units">units<a class="anchor" aria-label="anchor" href="#arg-units"></a></dt>
<dd><p>Corresponds to the argument of the same name in the <code><a href="https://rdrr.io/r/base/difftime.html" class="external-link">difftime</a></code> function. This argument is only used when the <code>time</code> column corresponds to a <code>Date</code> (or similar) variable. It should be used to indicate the time-scale of the created event time (seconds, days, years, ...).</p></dd>

  <dt id="arg-id">id<a class="anchor" aria-label="anchor" href="#arg-id"></a></dt>
<dd><p>A single character string specifying a column in <code>data</code>, specifying the unique case identifier. By default the same name that was used in the original <code><a href="match_time.html">match_time</a></code> is used here.</p></dd>

  <dt id="arg-time">time<a class="anchor" aria-label="anchor" href="#arg-time"></a></dt>
<dd><p>A single character string specifying a column in <code>data</code>, specifying the column containing the event times. By default the same name that was used in the original <code><a href="match_time.html">match_time</a></code> is used here.</p></dd>

  <dt id="arg-event-time-name">event_time_name<a class="anchor" aria-label="anchor" href="#arg-event-time-name"></a></dt>
<dd><p>A single character string specifying the name of the event time column that will be added to the <code>data</code> object contained in <code>x</code>. Defaults to <code>.event_time</code>. If the name is already present, an error message is returned instead.</p></dd>

  <dt id="arg-status-name">status_name<a class="anchor" aria-label="anchor" href="#arg-status-name"></a></dt>
<dd><p>A single character string specifying the name of the status column that will be added to the <code>data</code> object contained in <code>x</code>. Defaults to <code>.status</code>. If the name is already present, an error message is returned instead.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Different censoring schemes can be used for different target estimands. In intention-to-treat type analysis, users usually should not be censoring cases at their following treatment times. For per-protocol type analysis, setting <code>censor_at_treat</code> is usually the right decision. Whether to use <code>censor_pairs</code> is an additional choice that depends on how the user wants to handle the dependent censoring introduced by using <code>censor_at_treat=TRUE</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a modified <code>match_time</code> object. It is essentially the same object as the supplied <code>x</code>, but it also contains two new columns: <code>event_time_name</code> (the time until the event or censoring) and <code>status_name</code> (a logical variable indicating whether the event occurred or the case was censored).</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="match_time.html">match_time</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/MatchTime" class="external-link">MatchTime</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># only execute if packages are available</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"survival"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"MatchIt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/" class="external-link">MatchIt</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set random seed to make the output replicably</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load "heart" data from survival package</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"heart"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">heart</span> <span class="op">&lt;-</span> <span class="va">heart</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"start"</span>, <span class="st">"stop"</span>, <span class="st">"transplant"</span>, <span class="st">"age"</span>, <span class="st">"surgery"</span><span class="op">)</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># suppose we had an extra dataset with events that looks like this</span></span></span>
<span class="r-in"><span><span class="co"># NOTE: these are not all events in the real "heart" data and is merely used</span></span></span>
<span class="r-in"><span><span class="co">#       for showcasing the functionality of add_outcome()</span></span></span>
<span class="r-in"><span><span class="va">d_events</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                       time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">6</span>, <span class="fl">16</span>, <span class="fl">39</span>, <span class="fl">18</span>, <span class="fl">3</span>, <span class="fl">675</span>, <span class="fl">40</span>, <span class="fl">85</span>, <span class="fl">58</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform nearest neighbor time-dependent matching on "age" and "surgery"</span></span></span>
<span class="r-in"><span><span class="co"># (plus exact matching on time)</span></span></span>
<span class="r-in"><span><span class="va">m_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="match_time.html">match_time</a></span><span class="op">(</span><span class="va">transplant</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">surgery</span>, data<span class="op">=</span><span class="va">heart</span>, id<span class="op">=</span><span class="st">"id"</span>,</span></span>
<span class="r-in"><span>                    match_method<span class="op">=</span><span class="st">"nearest"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add the event times to match_time object</span></span></span>
<span class="r-in"><span><span class="va">m_obj</span> <span class="op">&lt;-</span> <span class="fu">add_outcome</span><span class="op">(</span><span class="va">m_obj</span>, data<span class="op">=</span><span class="va">d_events</span>, time<span class="op">=</span><span class="st">"time"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">m_obj</span><span class="op">$</span><span class="va">data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Key: &lt;id&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       id .id_new .id_pair .treat .treat_time .next_treat_time .fully_matched</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    &lt;num&gt;   &lt;int&gt;   &lt;char&gt; &lt;lgcl&gt;       &lt;num&gt;            &lt;num&gt;         &lt;lgcl&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:     1      72       36  FALSE          27               NA           TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:     3       1        1   TRUE           1               NA           TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:     4      10        5  FALSE           2               36           TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:     4      89       45   TRUE          36               NA           TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:     7      86       43  FALSE          32               51           TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:     7     105       54   TRUE          51               NA          FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    .weights        age surgery .status .event_time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       &lt;num&gt;      &lt;num&gt;   &lt;num&gt;  &lt;lgcl&gt;       &lt;num&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1:        1 -17.155373       0    TRUE          23</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2:        1   6.297057       0    TRUE          15</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3:        1  -7.737166       0   FALSE          34</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4:        1  -7.737166       0    TRUE           3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5:        1   2.869268       0   FALSE          19</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6:        0   2.869268       0    TRUE         624</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fast Exact Matching with a Binary Treatment — fast_exact_matching • MatchTime</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fast Exact Matching with a Binary Treatment — fast_exact_matching"><meta name="description" content="This function matches one or multiple controls to cases that have exactly the same values in one or multiple categorical variables. Technically works with continuous variables as well, but this will probably not work well in practice due to a very low probability of exact matches."><meta property="og:description" content="This function matches one or multiple controls to cases that have exactly the same values in one or multiple categorical variables. Technically works with continuous variables as well, but this will probably not work well in practice due to a very low probability of exact matches."><meta property="og:image" content="https://robindenz1.github.io/MatchTime/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchTime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MatchTime.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_start_stop_data.html">Creating and Dealing with Start-Stop Data in R</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/MatchTime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fast Exact Matching with a Binary Treatment</h1>

      <div class="d-none name"><code>fast_exact_matching.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function matches one or multiple controls to cases that have exactly the same values in one or multiple categorical variables. Technically works with continuous variables as well, but this will probably not work well in practice due to a very low probability of exact matches.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fast_exact_matching</span><span class="op">(</span><span class="va">formula</span>, <span class="va">data</span>, replace<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                    ratio<span class="op">=</span><span class="fl">1</span>, estimand<span class="op">=</span><span class="st">"ATT"</span>,</span>
<span>                    remove_unmatched<span class="op">=</span><span class="cn">TRUE</span>, n_required<span class="op">=</span><span class="va">ratio</span>,</span>
<span>                    if_no_match<span class="op">=</span><span class="st">"warn"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A formula object with the binary treatment variable on the left-hand side and the variables to be matched on on the right hand side. The binary treatment should ideally be coded as a logical variable (<code>TRUE</code> = treated, <code>FALSE</code> = untreated). If this is not the case, the function internally coerces the variable to be logical using the rules described in the details.</p></dd>

  <dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.table</code> like object containing the columns mentioned in <code>formula</code>. Additional columns are allowed and will be included in the output, although they will not be matched on if not mentioned on the right hand side of <code>formula</code>.</p></dd>

  <dt id="arg-replace">replace<a class="anchor" aria-label="anchor" href="#arg-replace"></a></dt>
<dd><p>Whether to sample controls with or without replacement. As is usual in matching, when using <code>ratio &gt; 1</code> each control can only occur once per case. Note that using replacement makes this function significantly slower, because of the computational overhead in ensuring that each control is used only oncer per case.</p></dd>

  <dt id="arg-ratio">ratio<a class="anchor" aria-label="anchor" href="#arg-ratio"></a></dt>
<dd><p>How many control units should be matched to each treated unit in k:1 matching. Should be a single integer value. The default is 1 for 1:1 matching.</p></dd>

  <dt id="arg-estimand">estimand<a class="anchor" aria-label="anchor" href="#arg-estimand"></a></dt>
<dd><p>Which estimand to target. Can be either <code>"ATT"</code> (default) to get a dataset with which to estimate the average treatment effect on the treated, or to <code>"ATC"</code> which would target the average treatment effect for the untreated. When using <code>"ATC"</code>, the treatment labels are simply swapped internally before matching and swapped back afterwards.</p></dd>

  <dt id="arg-remove-unmatched">remove_unmatched<a class="anchor" aria-label="anchor" href="#arg-remove-unmatched"></a></dt>
<dd><p>Either <code>TRUE</code> (default) or <code>FALSE</code>, specifying whether to remove pairs with no or not enough matches. The number of matches that each case should have received during matching can be set using the <code>n_required</code> argument.</p></dd>

  <dt id="arg-n-required">n_required<a class="anchor" aria-label="anchor" href="#arg-n-required"></a></dt>
<dd><p>A single positive integer, specifying the number of matched controls a pair needs to have to stay in the data. For example, if 1:1 matching was used and the user only wants to keep pairs where cases actually did receive one control, it should be set to 1. If <code>ratio=3</code> was used and users want to keep all pairs with 2 or more matched controls, it should be set to 2 etc. By default, the number of matches specified in the <code>ratio</code> argument of the original <code><a href="match_time.html">match_time</a></code> call is used.</p></dd>

  <dt id="arg-if-no-match">if_no_match<a class="anchor" aria-label="anchor" href="#arg-if-no-match"></a></dt>
<dd><p>Must be either <code>"stop"</code>, <code>"warn"</code> (default) or <code>"nothing"</code>. Controls whether to throw an error, a warning or silently accept when not enough controls could be matched to one or more cases.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function first extracts all cases from <code>data</code>, which are defined as all rows in <code>data</code> where the binary variable (left-hand side of <code>formula</code>) is <code>TRUE</code>. A stratified random sample is then drawn from the remaining dataset consisting only of controls, where the strata are the variables that should be matched on. By drawing <code>ratio</code> controls for each case with exactly the same values in the strata as the respective case, perfectly exact <code>ratio:1</code> matching is performed. This is a very basic form of matching without a lot of flexibility. It also only supports binary treatments. In almost every case it would be much better to just use the <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></code> function from the excellent <code>MatchIt</code> package instead. The only reason to use the <code>fast_exact_matching</code> function is the better performance on large datasets.</p>
<p>Because controls are matched directly to cases by default, the resulting dataset may generally only be used to get estimates for the average treatment effect on the treated (ATT). By setting <code>estimand="ATC"</code>, the matching process is reversed. Instead of matching controls to cases, cases are then matched to controls resulting in a dataset that may be used to estimate the average treatment effect on the untreated (ATC). Other estimands are currently not supported.</p>
<p>The <code>.weights</code> column in the output is calculated using the same method that is used in <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></code>.</p>
<p><strong><em>Identifying the "treated" group</em></strong>:</p>
<p>Ideally, the treatment specified on the LHS of the <code>formula</code> argument is coded as a logical variable, where <code>TRUE</code> corresponds to the "treated" group and <code>FALSE</code> corresponds to the "control" group. If this is not the case, this function will coerce it to this type internally using the following rules:</p>
<p>1.) if the variable only consists of the numbers <code>0</code> and <code>1</code> (coded as numeric), <code>0</code> will be considered the "control" group and <code>1</code> the "treated" group; 2.) otherwise, if the variable is a factor, <code>levels(treat)[1]</code> will be considered the "control" group and the other value the "treated" group; 3.) otherwise <code>sort(unique(treat))[1]</code> will be considered "control" and the other value the treated. It is safest to ensure that the treatment variable is a logical variable. In either case, the output will only contain the treatment as logical variable.</p>
<p><strong><em>Using <code>replace=TRUE</code></em></strong>:</p>
<p>If <code>replace=TRUE</code> is used, the output may contain multiple rows for some supplied rows. Namely, it will include one row for every time the control was choosen as a control. For example, if id = 3 was used as a control for id = 5, 6, 7, 8, it will occur in the dataset 4 times, each time with a different <code>.id_pair</code>. If the user wants to differentiate between these cases, all that needs to be done is to add a unique id column (of any name) to the data before the matching process. As with any other variable in <code>data</code>, this variable will be preserved after matching.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a single <code>data.table</code> containing the same columns as <code>data</code> plus two additional columns called <code>".id_pair"</code>, which identifies which rows belong to one matched control / case pair and <code>.weights</code> (a numeric column including the matching weights).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Elizabeth A. Stuart (2010). "Matching Methods for Causal Inference: A Review and a Look Forward". In: Statistical Science 25.1, pp. 1-21.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="stratified_sample.html">stratified_sample</a></code>, <code><a href="https://kosukeimai.github.io/MatchIt/reference/matchit.html" class="external-link">matchit</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/MatchTime" class="external-link">MatchTime</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">12341</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## generate some random example data</span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span><span class="op">)</span>, size<span class="op">=</span><span class="va">n</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   age_cat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"10"</span>, <span class="st">"20"</span>, <span class="st">"30"</span><span class="op">)</span>, size<span class="op">=</span><span class="va">n</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   treatment<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">TRUE</span>, <span class="cn">FALSE</span><span class="op">)</span>, size<span class="op">=</span><span class="va">n</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                    replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform 1:1 exact matching on sex, without replacement</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">fast_exact_matching</span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">sex</span>,</span></span>
<span class="r-in"><span>                           data<span class="op">=</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                           ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform 3:1 exact matching on sex, without replacement</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">fast_exact_matching</span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">sex</span>,</span></span>
<span class="r-in"><span>                           data<span class="op">=</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                           ratio<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>                           replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform 1:1 exact matching on sex, with replacement using the ATC</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">fast_exact_matching</span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">sex</span>,</span></span>
<span class="r-in"><span>                           data<span class="op">=</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                           ratio<span class="op">=</span><span class="fl">1</span>,</span></span>
<span class="r-in"><span>                           estimand<span class="op">=</span><span class="st">"ATC"</span>,</span></span>
<span class="r-in"><span>                           replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform 1:1 exact matching on sex and age_cat, without replacement</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">fast_exact_matching</span><span class="op">(</span><span class="va">treatment</span> <span class="op">~</span> <span class="va">sex</span> <span class="op">+</span> <span class="va">age_cat</span>,</span></span>
<span class="r-in"><span>                           data<span class="op">=</span><span class="va">data</span>,</span></span>
<span class="r-in"><span>                           ratio<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


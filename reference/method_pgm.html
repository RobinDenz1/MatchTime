<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Time-Dependent Prognostic Score Matching — method_pgm • MatchTime</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Time-Dependent Prognostic Score Matching — method_pgm"><meta name="description" content='This documentation page describes the matching process used when setting method="pgm" in the match_time function and gives a detailed explanation on the supported additional arguments in this case.'><meta property="og:description" content='This documentation page describes the matching process used when setting method="pgm" in the match_time function and gives a detailed explanation on the supported additional arguments in this case.'><meta property="og:image" content="https://robindenz1.github.io/MatchTime/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchTime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_start_stop_data.html">Creating and Dealing with Start-Stop Data in R</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/MatchTime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Time-Dependent Prognostic Score Matching</h1>

      <div class="d-none name"><code>method_pgm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This documentation page describes the matching process used when setting <code>method="pgm"</code> in the <code><a href="match_time.html">match_time</a></code> function and gives a detailed explanation on the supported additional arguments in this case.</p>
    </div>


    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-event">event<a class="anchor" aria-label="anchor" href="#arg-event"></a></dt>
<dd><p>A single character string specifying a column in <code>data</code> containing the event status of interest. The outcome specified by this argument will be used as dependent variable in the prognostic score model. This argument therefore <em>must</em> be specified, otherwise an error will be produced. Note that this argument will be treated as an outcome by default and does not have to be added to <code>outcomes</code> in the main function call.</p></dd>

  <dt id="arg-formula-prog">formula_prog<a class="anchor" aria-label="anchor" href="#arg-formula-prog"></a></dt>
<dd><p>An optional formula object, specifying the right-hand side of the formula that should be used for the outcome model, or <code>NULL</code> (default). If <code>NULL</code>, the right-hand side of the <code>formula</code> argument is used to fit the model. This argument is useful mostly to specify interactions, non-linear effects or similar thing. Note that this formula object should start with <code>~</code> and have nothing on the left-hand side.</p></dd>

  <dt id="arg-prog-type">prog_type<a class="anchor" aria-label="anchor" href="#arg-prog-type"></a></dt>
<dd><p>A single character string, specifying which type of "prognostic score" to use. Currently supports <code>"p"</code>, which results in usage of the hazard of the outcome at time \(t\) and <code>"lp"</code>, which instead uses only the linear predictor of the model (disregarding the baseline hazard). Using <code>"lp"</code> is faster because the baseline hazard does not need to be estimated and because there is no need to calculate the actual hazard on each time where matching is done. See details.</p></dd>

  <dt id="arg-standardize-prog">standardize_prog<a class="anchor" aria-label="anchor" href="#arg-standardize-prog"></a></dt>
<dd><p>Either <code>TRUE</code> or <code>FALSE</code> (default), specifying whether to standardize the "prognostic score" as specified by <code>prog_type</code> to the 0 / 1 range. This might be beneficial for some matching strategies.</p></dd>

  <dt id="arg-basehaz-interpol">basehaz_interpol<a class="anchor" aria-label="anchor" href="#arg-basehaz-interpol"></a></dt>
<dd><p>A single character string controlling how the estimated baseline hazard should be interpolated. This is only used when <code>type_prog="p"</code>, in which case the baseline hazard is estimated from the fitted prognostic score Cox model using the <code><a href="https://rdrr.io/pkg/survival/man/basehaz.html" class="external-link">basehaz</a></code> function from the <span class="pkg">survival</span> package. Allowed values are <code>"constant"</code> (default) for step function interpolation (as usual for survival curves) or <code>"linear"</code> for linear interpolation. Should usually be kept at <code>"constant"</code>. Interpolation is performed internally using the <code><a href="https://rdrr.io/r/stats/approxfun.html" class="external-link">approxfun</a></code> function with <code>rule=2</code>.</p></dd>

  <dt id="arg-remove-prog">remove_prog<a class="anchor" aria-label="anchor" href="#arg-remove-prog"></a></dt>
<dd><p>Either <code>TRUE</code> or <code>FALSE</code> (default), specifying whether the estimated prognostic score should be removed from <code>data</code>. If <code>FALSE</code>, the prognostic score at <code>.treat_time</code> is included in the <code>.prog_score</code> column.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>All arguments of the <code><a href="match_time.html">match_time</a></code> function may be used when using <code>method="pgm"</code>, because of the general sequential nature of the matching. The only difference in the matching process is that matching is not performed directly on the covariates in <code>formula</code>, but instead is done only on an estimated time-dependent prognostic score at each point in time.</p>
<p><strong><em>How it works</em></strong>:</p>
<p>Time-dependent prognostic score matching is very similar to the more popular time-dependent propensity score matching (<code>method="psm"</code>). It works by first estimating the probability that an individual will experience an outcome event at t, given that the individual has not yet experienced the event up to this point and given that the individual did not yet receive the treatment. This is essentially just an estimate of the conditional survival probability, which is a standard quantity in time-to-event analysis. Hansen (2008) showed that matching on this score will result in unbiased estimates of the causal effect of interest. These results have been extended to the time-dependent context by He et al. (2020) and other authors (cited below).</p>
<p>This might seem weird at first. After all, one of the main reasons for using time-dependent matching is that it avoids fitting outcome models. Cox models with time-dependent variables also generally do not allow estimation of marginal effects in the presence of treatment-outcome feedback and other complex causal feedback loops. The important thing to keep in mind here is that the fitted outcome model is <em>not</em> used to actually estimate effects. It is a pure nuisance model, only used to predict the conditional hazard of the outcome given covariates under control conditions, which does not require as many assumptions as an actual causal analysis.</p>
<p><strong><em>Estimation of the prognostic score</em></strong>:</p>
<p>The prognostic score is estimated using a Cox model with the actual outcome of interest as the dependent variable in the first step. All variables on the RHS of the <code>formula</code> are used as independent variables (time-fixed and time-dependent ones). Importantly, only the time under control conditions for all individuals is used in this model. Individuals who do receive the treatment at some point during the observation period are artificially censored at this point in time. The model therefore does not include the treatment status as covariate.</p>
<p>The hazard of experiencing an outcome event, e.g. the time-dependent prognostic score, is then calculated for all individuals at each point where matching is performed. The matching is then done entirely using this prognostic score, ignoring all other covariates. The model used to predict the prognostic scores is included in the output object whenever <code>method="pgm"</code> is used.</p>
<p>Formally, the model can be described as:</p>
<p>$$h_Y(t) = h_{Y0}(t) e^{\beta X(t)},$$</p>
<p>where \(X(t)\) refers to an arbitrary amount of (possibly) time-dependent covariates. The matching is done either on \(\hat{h}_Y(t)\) (when using <code>prog_type="p"</code>) or only on the linear predictor \(e^{\beta X(t)}\) (when using <code>prog_type="lp"</code>). As explained in <code><a href="method_psm.html">?method_psm</a></code>, this only makes a difference when <code><a href="https://rdrr.io/pkg/survival/man/strata.html" class="external-link">strata</a></code> terms are included in the Cox model <code>formula</code>, in which case the default of <code>"p"</code> should be preferred.</p>
<p><strong><em>Interval Coding</em></strong>:</p>
<p>Because the <code>event</code> column of <code>data</code> will be used as the outcome in the Cox model as described above, its' intervals should be coded in the standard time-to-event outcome way as described in the <span class="pkg">survival</span> package. That means that instead of new intervals starting at the occurence of an event, existing intervals should be broken up at the event times with <code>event</code> being <code>1</code> or <code>TRUE</code> only at exactly these times. One option to create such data is to use the <code><a href="merge_start_stop.html">merge_start_stop</a></code> function of this package with appropriate input to the <code>event_times</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Hansen, Ben B. (2008). "The Prognostic Analogue of the Propensity Score". In: Biometrika 95.2, pp. 481-488.</p>
<p>He, Kevin, Yun Li, Panduranga S. Rao, Randall S. Sung, and Douglas E. Schaubel (2020). "Prognostic Score Matching Methods for Estimating the Average Effect of a Non-Reversible Binary Time-Dependent Treatment on the Survival Function". In: Lifetime Data Analysis 26, pp. 451-470.</p>
<p>Li, Yun, Douglas E. Schaubel, and Kevin He (2013). "Matching Methods for Obtaining Survival Functions to Estimate the Effect of a Time-Dependent Treatment". In: Statistics in Biosciences 6, pp. 105-126.</p>
<p>Smith, Abigail R. and Douglas E. Schaubel (2015). "Time-Dependent Prognostic Score Matching for Recurrent Event Analysis to Evaluate a Treatment Assigned During Follow-Up". In: Biometrics 71, pp. 950-959.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/MatchTime" class="external-link">MatchTime</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"survival"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"MatchIt"</span><span class="op">)</span> <span class="op">&amp;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"ggplot2"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://kosukeimai.github.io/MatchIt/" class="external-link">MatchIt</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># load some example data from the survival package</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"heart"</span>, package<span class="op">=</span><span class="st">"survival"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## time-dependent prognostic score matching, using "transplant" as treatment</span></span></span>
<span class="r-in"><span><span class="co">## and surgery + age as variables to match on</span></span></span>
<span class="r-in"><span><span class="va">m.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="match_time.html">match_time</a></span><span class="op">(</span><span class="va">transplant</span> <span class="op">~</span> <span class="va">surgery</span> <span class="op">+</span> <span class="va">age</span>, data<span class="op">=</span><span class="va">heart</span>, id<span class="op">=</span><span class="st">"id"</span>,</span></span>
<span class="r-in"><span>                    method<span class="op">=</span><span class="st">"pgm"</span>, event<span class="op">=</span><span class="st">"event"</span>, match_method<span class="op">=</span><span class="st">"nearest"</span>,</span></span>
<span class="r-in"><span>                    replace_over_t<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># showing a summary of the used prognostic score model</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m.obj</span><span class="op">$</span><span class="va">prog_model</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: algorithm did not converge</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>glm.fit: fitted probabilities numerically 0 or 1 occurred</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> survival::coxph(formula = stats::as.formula(cox_form), data = d_outcome)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   n= 103, number of events= 30 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             coef exp(coef) se(coef)      z Pr(&gt;|z|)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> surgery -0.56342   0.56926  0.61405 -0.918    0.359</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age      0.01458   1.01469  0.01843  0.791    0.429</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         exp(coef) exp(-coef) lower .95 upper .95</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> surgery    0.5693     1.7567    0.1709     1.897</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> age        1.0147     0.9855    0.9787     1.052</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Concordance= 0.573  (se = 0.063 )</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Likelihood ratio test= 1.52  on 2 df,   p=0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Wald test            = 1.4  on 2 df,   p=0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Score (logrank) test = 1.43  on 2 df,   p=0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


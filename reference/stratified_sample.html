<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fast Stratified Sampling from a data.table like object — stratified_sample • MatchTime</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fast Stratified Sampling from a data.table like object — stratified_sample"><meta name="description" content="This function may be used to draw a stratified random sample (with or without replacement) of rows from a data.table or similar object. It additionally includes options on how to handle cases in which the number to be drawn is less than the number of actual rows when using replace=FALSE, which makes it useful in exact matching."><meta property="og:description" content="This function may be used to draw a stratified random sample (with or without replacement) of rows from a data.table or similar object. It additionally includes options on how to handle cases in which the number to be drawn is less than the number of actual rows when using replace=FALSE, which makes it useful in exact matching."><meta property="og:image" content="https://robindenz1.github.io/MatchTime/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchTime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/MatchTime.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/creating_start_stop_data.html">Creating and Dealing with Start-Stop Data in R</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/MatchTime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fast Stratified Sampling from a <code>data.table</code> like object</h1>

      <div class="d-none name"><code>stratified_sample.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function may be used to draw a stratified random sample (with or without replacement) of rows from a <code>data.table</code> or similar object. It additionally includes options on how to handle cases in which the number to be drawn is less than the number of actual rows when using <code>replace=FALSE</code>, which makes it useful in exact matching.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stratified_sample</span><span class="op">(</span><span class="va">data</span>, <span class="va">n</span>, <span class="va">strata</span>, replace<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                  max_replace<span class="op">=</span><span class="cn">NULL</span>, if_lt_n<span class="op">=</span><span class="st">"stop"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A <code>data.table</code> like object that should be sampled from. May also be any object that can be coerced to be a <code>data.table</code>, such as a <code>data.frame</code> or a <code>tibble</code>.</p></dd>

  <dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>A named numeric vector containing values &gt; 0, specifying the number of rows that should be sampled for each value in <code>strata</code>.</p></dd>

  <dt id="arg-strata">strata<a class="anchor" aria-label="anchor" href="#arg-strata"></a></dt>
<dd><p>A single character string specifying the integer, character or factor variable representing the strata that should be sampled from in <code>data</code>. Only supports a single variable. If data should be sampled from strata of multiple variables, the user needs to first create a single variable from these multiple variables as shown in the examples.</p></dd>

  <dt id="arg-replace">replace<a class="anchor" aria-label="anchor" href="#arg-replace"></a></dt>
<dd><p>Either <code>TRUE</code> or <code>FALSE</code> (default). Specifies whether the sampling should be performed with or without replacement.</p></dd>

  <dt id="arg-max-replace">max_replace<a class="anchor" aria-label="anchor" href="#arg-max-replace"></a></dt>
<dd><p>Either <code>NULL</code> (default) or a named numeric vector containing values &gt; 0, specifying the number of times that rows in each value of <code>strata</code> may be replace when using <code>replace=TRUE</code>. Ignored if <code>replace=FALSE</code>. Keeping this argument at <code>NULL</code> results in no upper limit on replacement of rows per <code>strata</code>.</p></dd>

  <dt id="arg-if-lt-n">if_lt_n<a class="anchor" aria-label="anchor" href="#arg-if-lt-n"></a></dt>
<dd><p>Must be either <code>"stop"</code>, <code>"warn"</code> or <code>"nothing"</code>. Controls whether to throw an error, a warning or silently accept when the number of rows in a stratum specified by <code>strata</code> is smaller than the number that should be sampled from it and <code>replace=FALSE</code> is used.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Internally splits the <code>data.table</code> into parts as defined by the <code>strata</code> variable and then uses the <code><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></code> function to sample rows from these strata. By using only <code>data.table</code> functions and <code><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample.int</a></code> instead of <code>sample</code>, this function is very efficient even for very large <code>data.tables</code> and many possible strata.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Returns a single <code>data.table</code> containing the sampled rows.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Lohr, Sharon L. (2010). Sampling: Design and Analysis. Bd. 2. Boston: Cengage Learning.</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Robin Denz</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fast_exact_matching.html">fast_exact_matching</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/MatchTime" class="external-link">MatchTime</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/fastmatch" class="external-link">fastmatch</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">344</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>A<span class="op">=</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   B<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">100</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                   strat<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1"</span>, <span class="st">"2"</span>, <span class="st">"3"</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">100</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">25</span>, <span class="fl">31</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2"</span>, <span class="st">"1"</span>, <span class="st">"3"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># sample (without replacement):</span></span></span>
<span class="r-in"><span><span class="co"># - 25 rows from strat=="1"</span></span></span>
<span class="r-in"><span><span class="co"># - 10 rows from strat=="2"</span></span></span>
<span class="r-in"><span><span class="co"># - 31 rows from strat=="3"</span></span></span>
<span class="r-in"><span><span class="va">samp</span> <span class="op">&lt;-</span> <span class="fu">stratified_sample</span><span class="op">(</span><span class="va">data</span>, n<span class="op">=</span><span class="va">n</span>, strata<span class="op">=</span><span class="st">"strat"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># take the same stratified sample with replacement</span></span></span>
<span class="r-in"><span><span class="va">samp</span> <span class="op">&lt;-</span> <span class="fu">stratified_sample</span><span class="op">(</span><span class="va">data</span>, n<span class="op">=</span><span class="va">n</span>, strata<span class="op">=</span><span class="st">"strat"</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Creating and Dealing with Start-Stop Data in R • MatchTime</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Creating and Dealing with Start-Stop Data in R">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MatchTime</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/creating_start_stop_data.html">Creating and Dealing with Start-Stop Data in R</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/RobinDenz1/MatchTime/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Creating and Dealing with Start-Stop Data in R</h1>
                        <h4 data-toc-skip class="author">Robin Denz</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/RobinDenz1/MatchTime/blob/main/vignettes/creating_start_stop_data.rmd" class="external-link"><code>vignettes/creating_start_stop_data.rmd</code></a></small>
      <div class="d-none name"><code>creating_start_stop_data.rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A very common task in survival analysis, and other types of analyses
that involve time-varying covariates, is the creation of start-stop
datasets. These datasets should include multiple intervals per subject
or case, along with one or multiple covariate values that correspond to
the value observed during the defined time-intervals. The
<code>MatchTime</code> package offers a wide range of functions to
create and transform such datasets from other data sources (mostly
because they are also required as input in its main function,
<code><a href="../reference/match_time.html">match_time()</a></code>).</p>
<p>The goal of these functions is to make it easy to create valid
start-stop datasets and to further process existing ones, even when
there are millions of cases and/or a large amount of intervals. The
current standard tool to create start-stop data is the
<code><a href="https://rdrr.io/pkg/survival/man/tmerge.html" class="external-link">tmerge()</a></code> function from the <code>survival</code> package,
which was not originally meant to handle large datasets. In contrast,
the implementations offered here rely exclusively on code written using
the <code>data.table</code> back-end, making them faster and more RAM
efficient. Additionally, the functions included in
<code>MatchTime</code> work well with incomplete information, which
often occurs in real data.</p>
</div>
<div class="section level2">
<h2 id="what-is-start-stop-data">What is Start-Stop Data?<a class="anchor" aria-label="anchor" href="#what-is-start-stop-data"></a>
</h2>
<div class="section level3">
<h3 id="covariates">Covariates<a class="anchor" aria-label="anchor" href="#covariates"></a>
</h3>
<p>First, let’s be a little more clear what exactly constitutes a
start-stop dataset. Consider the following example:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/RobinDenz1/MatchTime" class="external-link">MatchTime</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">28</span>, <span class="fl">120</span>, <span class="fl">125</span><span class="op">)</span>,</span>
<span>                   stop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">112</span>, <span class="fl">28</span>, <span class="fl">120</span>, <span class="fl">125</span>, <span class="fl">213</span><span class="op">)</span>,</span>
<span>                   sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"m"</span>, <span class="st">"m"</span>, <span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                   bmi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">34</span>, <span class="fl">38</span>, <span class="fl">27</span>, <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">26</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id start  stop    sex   bmi</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1     0    10      m    32</span></span>
<span><span class="co">## 2:     1    10    50      m    34</span></span>
<span><span class="co">## 3:     1    50   112      m    38</span></span>
<span><span class="co">## 4:     2     0    28      f    27</span></span>
<span><span class="co">## 5:     2    28   120      f    28</span></span>
<span><span class="co">## 6:     2   120   125      f    35</span></span>
<span><span class="co">## 7:     2   125   213      f    26</span></span></code></pre>
<p>The dataset shown above consists of two individuals (two distinct
<code>id</code> values) with multiple recorded time-intervals each
(defined by the <code>start</code> and <code>stop</code> columns).
Additionally, it includes information on the <code>sex</code> and the
<code>bmi</code> (Body-Mass-Index) of the individual. In this concrete
example, individual 1 is considered male (<code>sex="m"</code>) and
individual 2 is considered female (<code>sex="f"</code>) for the entire
observed duration. In other words, <code>sex</code> is a
<strong>time-fixed</strong> of <strong>time-constant</strong> variable.
On the other hand, each of the two individuals have multiple different
values in the <code>bmi</code> column, making it a
<strong>time-varying</strong> or <strong>time-dependent</strong>
variable.</p>
<p>More specifically, we would say that the value of <code>bmi</code>
for individual 1 was 32 from
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">t = 0</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>10</mn></mrow><annotation encoding="application/x-tex">t = 10</annotation></semantics></math>.
Afterwards it changed to 34 and stayed on that value until
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>50</mn></mrow><annotation encoding="application/x-tex">t = 50</annotation></semantics></math>.
Here, the <code>start</code> value is <em>included</em> in the interval,
while the <code>stop</code> value is <em>excluded</em>. This type of
coding is known as <strong>right-open</strong> or
<strong>left-closed</strong> intervals (because the <code>start</code>
value is considered to be in the interval, while the <code>stop</code>
value is not). This is usually denoted as <code>[start, stop)</code> and
is the usual way these intervals are coded for time-to-event purposes.
Throughout this package we will rely exclusively on this type of
intervals.</p>
<p>Note that in reality the values of time-dependent variables does not
necessarily change instantaneously. To allow a data representation it is
however necessary to define some intervals in which the value stays
constant. The width of these intervals is usually dependent on the type
of data one has access to.</p>
</div>
<div class="section level3">
<h3 id="outcomes">Outcomes<a class="anchor" aria-label="anchor" href="#outcomes"></a>
</h3>
<p>In addition to time-fixed and time-dependent variables we usually
also need to consider <strong>outcomes</strong>. In classic start-stop
datasets, outcomes are usually either binary or categorical indicators
of an event (possibly of some type) occurring at specific points in
time. These sort of events need to be coded slightly differently than
standard time-dependent variables. Below we give an example of the same
dataset shown earlier, with an additional <code>event</code> column
added to it, which contains a binary outcome event indicator:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                   start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">0</span>, <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">120</span>, <span class="fl">125</span>, <span class="fl">127</span><span class="op">)</span>,</span>
<span>                   stop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">112</span>, <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">120</span>, <span class="fl">125</span>, <span class="fl">127</span>, <span class="fl">213</span><span class="op">)</span>,</span>
<span>                   sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"m"</span>, <span class="st">"m"</span>, <span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"f"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                   bmi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">34</span>, <span class="fl">38</span>, <span class="fl">27</span>, <span class="fl">28</span>, <span class="fl">28</span>, <span class="fl">35</span>, <span class="fl">26</span>, <span class="fl">26</span><span class="op">)</span>,</span>
<span>                   event<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id start  stop    sex   bmi event</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1     0    10      m    32     0</span></span>
<span><span class="co">## 2:     1    10    50      m    34     0</span></span>
<span><span class="co">## 3:     1    50   112      m    38     1</span></span>
<span><span class="co">## 4:     2     0    28      f    27     0</span></span>
<span><span class="co">## 5:     2    28    35      f    28     1</span></span>
<span><span class="co">## 6:     2    35   120      f    28     0</span></span>
<span><span class="co">## 7:     2   120   125      f    35     0</span></span>
<span><span class="co">## 8:     2   125   127      f    26     1</span></span>
<span><span class="co">## 9:     2   127   213      f    26     0</span></span></code></pre>
<p>The main difference between the coding of time-varying variables and
outcome events is that while the intervals should always reflect time
durations in which the covariates stay constant, events are instead
coded to occur exactly at the end of an interval. So in essence,
existing intervals are simply broken off into two if a single event
happens during it. With terminal events, such as death, the observation
period ends with the first event. In the dataset above,
<code>id = 1</code> would be an example for this phenomenon. This
individual experiences an event at 112, with no more data
afterwards.</p>
<p>An example for recurrent events is given in <code>id = 2</code>. This
person experiences an event at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>35</mn></mrow><annotation encoding="application/x-tex">t = 35</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>127</mn></mrow><annotation encoding="application/x-tex">t = 127</annotation></semantics></math>.
As can be seen in the data, although neither <code>sex</code> nor
<code>bmi</code> changed between
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>28</mn></mrow><annotation encoding="application/x-tex">t = 28</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>120</mn></mrow><annotation encoding="application/x-tex">t = 120</annotation></semantics></math>,
the interval is broken into two rows to show that the event occurred at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>35</mn></mrow><annotation encoding="application/x-tex">t = 35</annotation></semantics></math>.
While we use right-open intervals for covariates, events are always
coded to occur <em>exactly</em> at the <code>stop</code> value.</p>
<p>We could directly use this sort of data to fit a Cox proportional
hazards regression model with time-dependent covariates, using the
following syntax:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">start</span>, <span class="va">stop</span>, <span class="va">event</span><span class="op">)</span> <span class="op">~</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">sex</span>, data<span class="op">=</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Call:</span></span>
<span><span class="co">## coxph(formula = Surv(start, stop, event) ~ bmi + sex, data = data)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##   n= 9, number of events= 3 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            coef  exp(coef)   se(coef)      z Pr(&gt;|z|)</span></span>
<span><span class="co">## bmi   1.060e+01  4.019e+04  1.421e+04  0.001    0.999</span></span>
<span><span class="co">## sexm -8.481e+01  1.468e-37  1.172e+05 -0.001    0.999</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##      exp(coef) exp(-coef) lower .95 upper .95</span></span>
<span><span class="co">## bmi  4.019e+04  2.488e-05         0       Inf</span></span>
<span><span class="co">## sexm 1.468e-37  6.811e+36         0       Inf</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Concordance= 1  (se = 0 )</span></span>
<span><span class="co">## Likelihood ratio test= 2.77  on 2 df,   p=0.3</span></span>
<span><span class="co">## Wald test            = 0  on 2 df,   p=1</span></span>
<span><span class="co">## Score (logrank) test = 2  on 2 df,   p=0.4</span></span></code></pre>
<p>Note that in this case the outcome is entirely nonsensical, because
the data is made up and there are only two individuals in it, but the
overall structure is exactly what would be required for a
<code><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph()</a></code> call (or <code><a href="../reference/match_time.html">match_time()</a></code> call).</p>
</div>
</div>
<div class="section level2">
<h2 id="overview-of-included-functions">Overview of Included Functions<a class="anchor" aria-label="anchor" href="#overview-of-included-functions"></a>
</h2>
<p>The following functions of <code>MatchTime</code> may be used to deal
with start-stop data:</p>
<ul>
<li>
<code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code>: Merges two or more start-stop
datasets</li>
<li>
<code><a href="../reference/subset_start_stop.html">subset_start_stop()</a></code>: Takes a subset of intervals from a
start-stop dataset</li>
<li>
<code><a href="../reference/simplify_start_stop.html">simplify_start_stop()</a></code>: Combines rows from a start-stop
dataset when possible</li>
<li>
<code><a href="../reference/add_missing_intervals.html">add_missing_intervals()</a></code>: Adds missing time-intervals to
“incomplete” start-stop datasets</li>
<li>
<code><a href="../reference/start_stop2long.html">start_stop2long()</a></code>: Creates a long-format dataset from a
start-stop dataset</li>
<li>
<code><a href="../reference/long2start_stop.html">long2start_stop()</a></code>: Creates a start-stop dataset from a
long-format dataset</li>
<li>
<code><a href="../reference/times_from_start_stop.html">times_from_start_stop()</a></code>: Extracts specific “event”
times from a start-stop dataset</li>
</ul>
<p>If a complete long-format dataset already exists, the easiest way to
obtain a start-stop dataset is to use the <code><a href="../reference/long2start_stop.html">long2start_stop()</a></code>
function. This, however, only works for discrete-time data and is only a
feasibly alternative if the full long-format data is small enough to fit
into the available RAM, which is not always the case.</p>
<p>Most users will only need the <code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code>
function to create a single start-stop dataset from different datasets
containing time-dependent information. This function has the advantage
that it does not blow up the dataset to the long-format, making it
feasible to create start-stop data for very large datasets. The other,
more advanced, functions are most useful when dealing with messy
real-world data.</p>
</div>
<div class="section level2">
<h2 id="the-merge_start_stop-function">The <code>merge_start_stop()</code> function<a class="anchor" aria-label="anchor" href="#the-merge_start_stop-function"></a>
</h2>
<p>The most important function to create start-stop data included in
this package is the <code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code> function. Its’ main
purpose is to merge two or more datasets that contain information about
time-intervals.</p>
<p>Suppose you have the following information about the treatment status
of multiple individuals:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_treat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                      start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">16</span>, <span class="fl">21</span>, <span class="fl">27</span>, <span class="fl">0</span>, <span class="fl">12</span>, <span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                      stop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">21</span>, <span class="fl">27</span>, <span class="fl">101</span>, <span class="fl">12</span>, <span class="fl">66</span>, <span class="fl">2</span>, <span class="fl">98</span>, <span class="fl">3</span>, <span class="fl">88</span><span class="op">)</span>,</span>
<span>                      treatment<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_treat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        id start  stop treatment</span></span>
<span><span class="co">##     &lt;num&gt; &lt;num&gt; &lt;num&gt;     &lt;num&gt;</span></span>
<span><span class="co">##  1:     1     0    16         0</span></span>
<span><span class="co">##  2:     1    16    21         1</span></span>
<span><span class="co">##  3:     1    21    27         0</span></span>
<span><span class="co">##  4:     1    27   101         1</span></span>
<span><span class="co">##  5:     2     0    12         0</span></span>
<span><span class="co">##  6:     2    12    66         1</span></span>
<span><span class="co">##  7:     3     0     2         1</span></span>
<span><span class="co">##  8:     3     2    98         0</span></span>
<span><span class="co">##  9:     4     0     3         1</span></span>
<span><span class="co">## 10:     4     3    88         0</span></span></code></pre>
<p>This dataset is already in the start-stop format, but it contains
only information about the treatment status of each individual. Note
that <code>treatment</code> is coded as (<code>0</code> = treatment
absent, <code>1</code> = treatment present). For example,
<code>id = 1</code> received the treatment between 16-21 and 27-101
only, while <code>id = 2</code> only received the treatment during the
interval 12-66.</p>
<p>Imagine that you also have some information on an additional
time-dependent covariate, which is the individuals place of residence
(denoted <code>region</code>), also in the start-stop format,:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_region</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>                       stop<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">101</span>, <span class="fl">20</span>, <span class="fl">66</span>, <span class="fl">98</span>, <span class="fl">88</span><span class="op">)</span>,</span>
<span>                       region<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_region</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id start  stop region</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt;</span></span>
<span><span class="co">## 1:     1     0   101      A</span></span>
<span><span class="co">## 2:     2     0    20      B</span></span>
<span><span class="co">## 3:     2    20    66      A</span></span>
<span><span class="co">## 4:     3     0    98      C</span></span>
<span><span class="co">## 5:     4     0    88      D</span></span></code></pre>
<p>In this dataset, only the individual with <code>id = 2</code> moved
(from <code>B</code> to <code>A</code> at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>20</mn></mrow><annotation encoding="application/x-tex">t = 20</annotation></semantics></math>).
Finally, we have another dataset which includes the time of death for
all individuals, if they are known to have died:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_death</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>                      time<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">101</span>, <span class="fl">98</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_death</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id  time</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1   101</span></span>
<span><span class="co">## 2:     3    98</span></span></code></pre>
<p>Our goal is now to combine these different datasets into a single
start-stop dataset. This can be done using the following
<code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code> call:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_start_stop.html">merge_start_stop</a></span><span class="op">(</span><span class="va">d_treat</span>, <span class="va">d_region</span>,</span>
<span>                          by<span class="op">=</span><span class="st">"id"</span>,</span>
<span>                          start<span class="op">=</span><span class="st">"start"</span>,</span>
<span>                          stop<span class="op">=</span><span class="st">"stop"</span>,</span>
<span>                          event_times<span class="op">=</span><span class="va">d_death</span>,</span>
<span>                          time_to_first_event<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;id&gt;</span></span>
<span><span class="co">##        id start  stop region treatment status</span></span>
<span><span class="co">##     &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;char&gt;     &lt;num&gt; &lt;lgcl&gt;</span></span>
<span><span class="co">##  1:     1     0    16      A         0  FALSE</span></span>
<span><span class="co">##  2:     1    16    21      A         1  FALSE</span></span>
<span><span class="co">##  3:     1    21    27      A         0  FALSE</span></span>
<span><span class="co">##  4:     1    27   101      A         1   TRUE</span></span>
<span><span class="co">##  5:     2     0    12      B         0  FALSE</span></span>
<span><span class="co">##  6:     2    12    20      B         1  FALSE</span></span>
<span><span class="co">##  7:     2    20    66      A         1  FALSE</span></span>
<span><span class="co">##  8:     3     0     2      C         1  FALSE</span></span>
<span><span class="co">##  9:     3     2    98      C         0   TRUE</span></span>
<span><span class="co">## 10:     4     0     3      D         1  FALSE</span></span>
<span><span class="co">## 11:     4     3    88      D         0  FALSE</span></span></code></pre>
<p>In this function call, we supplied the datasets containing
time-dependent variables to the <code>x</code> and <code>y</code>
argument, but passed the dataset containing the outcome events
(<code>death</code>) to the <code>event_times</code> argument instead.
We do this here because events usually have to be coded differently than
time-dependent covariates, as described earlier.</p>
<p>On the surface, all that <code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code> does here is
to combine (e.g. merge) the different start-stop datasets. And this is
in fact all that it does. However, this is also all that needs to be
done in order to create useful start-stop datasets. All that users have
to do is to create datasets for each time-dependent variable (or groups
of them) and to combine them afterwards. Below we will illustrate this
in a little more depth.</p>
</div>
<div class="section level2">
<h2 id="generating-start-stop-datasets-from-scratch">Generating Start-Stop Datasets from Scratch<a class="anchor" aria-label="anchor" href="#generating-start-stop-datasets-from-scratch"></a>
</h2>
<p>In the preceeding section, we gave a small example of combining
different datasets that were already in the start-stop format
themselves. In this section, we will relax this assumption by
considering less structured input.</p>
<div class="section level3">
<h3 id="the-input">The Input<a class="anchor" aria-label="anchor" href="#the-input"></a>
</h3>
<p>In many cases the information that should be included in the desired
start-stop dataset is stored in different tables that are not already in
the start-stop format themselves. For example, suppose we are interested
in creating a start-stop dataset including information about the
<code>bmi</code>, <code>sex</code>, <code>birthyear</code> and
<code>chemo</code>-therapy status of different individuals over time.
Suppose further that we only have the following three datasets:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_demographics</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                             sex<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"m"</span>, <span class="st">"f"</span><span class="op">)</span>,</span>
<span>                             birthyear<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1954</span>, <span class="fl">1962</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_demographics</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id    sex birthyear</span></span>
<span><span class="co">##    &lt;num&gt; &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">## 1:     1      m      1954</span></span>
<span><span class="co">## 2:     2      f      1962</span></span></code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                    start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">190</span>, <span class="fl">256</span>, <span class="fl">78</span>, <span class="fl">235</span><span class="op">)</span>,</span>
<span>                    bmi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">41</span>, <span class="fl">37</span>, <span class="fl">32</span>, <span class="fl">39</span>, <span class="fl">31</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_bmi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id start   bmi</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1    25    41</span></span>
<span><span class="co">## 2:     1   190    37</span></span>
<span><span class="co">## 3:     1   256    32</span></span>
<span><span class="co">## 4:     2    78    39</span></span>
<span><span class="co">## 5:     2   235    31</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_chemo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>id<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>                      start<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">112</span>, <span class="fl">82</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_chemo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id start</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1   112</span></span>
<span><span class="co">## 2:     2    82</span></span></code></pre>
<p>In this example all three datasets contain information about two
fictional individuals, <code>id = 1</code> and <code>id = 2</code>. The
dataset <code>d_demographics</code> contains some time-constant
information about each individual (<code>sex</code> and
<code>birthyear</code>). The dataset <code>d_bmi</code> on the other
hand, consists of <code>bmi</code> measurements of each person taken at
a specific point in time. Similarly, the <code>d_chemo</code> dataset
includes the time at which a person received a chemotherapy. To generate
a start-stop dataset from these three tables, we will have to make some
decisions on how the resulting dataset should look like. Based on these
decisions, we need to augment them a little bit before we can use the
functions included in this package.</p>
<p>The general course of action should be:</p>
<ul>
<li>1.) Define singular start-stop datasets for each time-varying
variable</li>
<li>2.) Merge them together using <code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code>
</li>
</ul>
<p>These points are explained in detail below.</p>
</div>
<div class="section level3">
<h3 id="defining-time-intervals-for-each-time-varying-variable">Defining Time-Intervals for each Time-Varying Variable<a class="anchor" aria-label="anchor" href="#defining-time-intervals-for-each-time-varying-variable"></a>
</h3>
<div class="section level4">
<h4 id="bmi">BMI<a class="anchor" aria-label="anchor" href="#bmi"></a>
</h4>
<p>The first question we need to ask is: How do we interpolate between
<code>bmi</code> measurements? Since we only took measurements at
specific times, we don’t actually know the value of <code>bmi</code>
between those measurements. In this case we will simply assume that the
value stayed constant until the next measurement (which is what is
usually done in practice). Given this decision, we have to create
time-intervals that define where the respective <code>bmi</code> value
applies. I conveniently already named the time variable
<code>start</code> here to make this a little more obvious. This can be
done in three steps.</p>
<p><em>1.) Sort the dataset by <code>id</code> and
<code>time</code></em></p>
<p>Using the <code>data.table</code> package, this can be done like this
(although it is already sorted in this example):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">d_bmi</span>, <span class="va">id</span>, <span class="va">start</span><span class="op">)</span></span></code></pre></div>
<p><em>2.) Shift the time variable</em></p>
<p>Next we again use the <code>data.table</code> package to shift the
time variable up by one row per <code>id</code>, creating the
<code>stop</code> column:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_bmi</span><span class="op">[</span>, <span class="va">stop</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/shift.html" class="external-link">shift</a></span><span class="op">(</span><span class="va">start</span>, type<span class="op">=</span><span class="st">"lead"</span><span class="op">)</span>, by<span class="op">=</span><span class="va">id</span><span class="op">]</span></span></code></pre></div>
<p><em>3.) Deal with the last row</em></p>
<p>Through step 2 we were able to create a <code>stop</code> value for
each row per person, except the last one. The question in this case is,
how long can the last measured value of <code>bmi</code> be expected to
be valid? In many cases there is some administrative end of the
follow-up which can serve to define this point in time. In other cases
some assumptions may be reasonable. If neither of these options work, it
might be best to just remove those rows. In our example we will consider
a final follow-up time of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>500</mn></mrow><annotation encoding="application/x-tex">t = 500</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_bmi</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">stop</span><span class="op">)</span>, <span class="va">stop</span> <span class="op">:=</span> <span class="fl">500</span><span class="op">]</span></span></code></pre></div>
<p>The result looks like this:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_bmi</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;id, start&gt;</span></span>
<span><span class="co">##       id start   bmi  stop</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;</span></span>
<span><span class="co">## 1:     1    25    41   190</span></span>
<span><span class="co">## 2:     1   190    37   256</span></span>
<span><span class="co">## 3:     1   256    32   500</span></span>
<span><span class="co">## 4:     2    78    39   235</span></span>
<span><span class="co">## 5:     2   235    31   500</span></span></code></pre>
<p>Essentially, this is now a start-stop dataset by itself, which is the
exactly the goal of this exercise. Once we have start-stop datasets for
each time-varying variable, we can simply merge them using the
<code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code> function.</p>
<p>Note that it may also be a valid choice to “flip” the intervals. In
this case we could have coded the intervals to start at 0 (or some other
t) and stay at the first observed value of <code>bmi</code> until
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">t = 25</annotation></semantics></math>
for id = 1. Which option to choose might have serious consequences, but
depends entirely on what kind of data you are dealing with.</p>
</div>
<div class="section level4">
<h4 id="chemo">Chemo<a class="anchor" aria-label="anchor" href="#chemo"></a>
</h4>
<p>The next question we need to answer is: What kind of
<code>chemo</code> variable do we need? There is a unlimited variety of
options here. We could, for example, be interested in a sort of variable
which includes the information “has received a <code>chemo</code> in the
last x time units”. For exemplary purposes we will first produce a
variable that simply states whether someone received a
<code>chemo</code> in the last 100 time units. This can be done by again
defining a fitting <code>stop</code> column:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_chemo</span><span class="op">[</span>, <span class="va">stop</span> <span class="op">:=</span> <span class="va">start</span> <span class="op">+</span> <span class="fl">100</span><span class="op">]</span></span></code></pre></div>
<p>We have now created a start-stop dataset again. Secondly, we have to
define the value that this variable should have if that condition is
met. We could use something like <code>"yes"</code> or <code>1</code>,
but the simplest (and most memory efficient) approach is to use
<code>TRUE</code>. Since the mini start-stop dataset only includes rows
where the condition is met, we can simple set the entire column to this
value:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_chemo</span><span class="op">[</span>, <span class="va">chemo</span> <span class="op">:=</span> <span class="cn">TRUE</span><span class="op">]</span></span></code></pre></div>
<p>The resulting dataset looks like this:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">d_chemo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       id start  stop  chemo</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;lgcl&gt;</span></span>
<span><span class="co">## 1:     1   112   212   TRUE</span></span>
<span><span class="co">## 2:     2    82   182   TRUE</span></span></code></pre>
<p>Note that there is no need to change the <code>d_demographics</code>
dataset, because it does not contain any time-varying information.</p>
</div>
</div>
<div class="section level3">
<h3 id="merging-the-time-intervals-for-each-time-varying-variable">Merging the Time-Intervals for each Time-Varying Variable<a class="anchor" aria-label="anchor" href="#merging-the-time-intervals-for-each-time-varying-variable"></a>
</h3>
<p>All that is left to do is call the <code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code>
function to, well, merge the time-intervals of <code>bmi</code> and
<code>chemo</code>. The following function call may be used:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_start_stop.html">merge_start_stop</a></span><span class="op">(</span><span class="va">d_chemo</span>, <span class="va">d_bmi</span>, by<span class="op">=</span><span class="st">"id"</span>,</span>
<span>                        defaults<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>chemo<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>                        constant_vars<span class="op">=</span><span class="va">d_demographics</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Key: &lt;id&gt;</span></span>
<span><span class="co">##       id start  stop   bmi  chemo    sex birthyear</span></span>
<span><span class="co">##    &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;lgcl&gt; &lt;char&gt;     &lt;num&gt;</span></span>
<span><span class="co">## 1:     1    25   112    41  FALSE      m      1954</span></span>
<span><span class="co">## 2:     1   112   190    41   TRUE      m      1954</span></span>
<span><span class="co">## 3:     1   190   212    37   TRUE      m      1954</span></span>
<span><span class="co">## 4:     1   212   256    37  FALSE      m      1954</span></span>
<span><span class="co">## 5:     1   256   500    32  FALSE      m      1954</span></span>
<span><span class="co">## 6:     2    78    82    39  FALSE      f      1962</span></span>
<span><span class="co">## 7:     2    82   182    39   TRUE      f      1962</span></span>
<span><span class="co">## 8:     2   182   235    39  FALSE      f      1962</span></span>
<span><span class="co">## 9:     2   235   500    31  FALSE      f      1962</span></span></code></pre>
<p>Again, we simply supply the variable-specific start-stop datasets
first and set the <code>by</code> argument to the person identifier.
Additionally, we set the <code>defaults</code> argument to
<code>list(chemo=FALSE)</code>, which essentially tells the
<code><a href="../reference/merge_start_stop.html">merge_start_stop()</a></code> function that the value of the
<code>chemo</code> column should be <code>FALSE</code> for all
time-intervals outside of the ones defined by the <code>d_chemo</code>
dataset. Additionally, since the information in
<code>d_demographics</code> is time-independent, it should be supplied
to the <code>constant_vars</code> argument.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Robin Denz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer>
</div>





  </body>
</html>
